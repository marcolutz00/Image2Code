<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Export news from google sites</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:700|Merriweather:400,400italic,700" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #fcfcfc;
      font-family: 'Merriweather', Georgia, 'Times New Roman', Times, serif;
    }

    body {
      color: #444;
      font-size: 17px;
      min-height: 100vh;
      box-sizing: border-box;
    }

    .container {
      max-width: 720px;
      margin: 0 auto;
      background: #fff;
      padding: 0 40px 64px 40px;
      box-sizing: border-box;
      min-height: 100vh;
      box-shadow: none;
    }

    header {
      width: 100%;
      margin-top: 32px;
      margin-bottom: 52px;
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      font-family: 'Merriweather', Georgia, serif;
    }
    .site-title {
      font-size: 20px;
      font-weight: 400;
      color: #333;
      letter-spacing: 0;
      margin-left: 2px;
    }
    .top-link {
      font-size: 16px;
      color: #757575;
      text-decoration: none;
    }

    main {
      width: 100%;
    }

    h1 {
      font-family: 'Roboto Slab', 'Merriweather', serif;
      font-weight: 700;
      font-size: 44px;
      line-height: 1.12;
      color: #333;
      margin: 0 0 16px 0;
      letter-spacing: -1px;
    }

    .meta {
      color: #888;
      font-size: 16px;
      font-style: italic;
      margin-bottom: 18px;
      margin-top: 0;
      font-family: 'Merriweather', Georgia, serif;
    }
    .meta span {
      margin-right: 7px;
    }

    .lead {
      margin-bottom: 24px;
      margin-top: 0;
      font-size: 17px;
      color: #444;
    }

    .lead a {
      color: #448bc6;
      text-decoration: underline;
      transition: color 0.2s;
      font-size: 17px;
    }

    .example-note {
      color: #444;
      font-size: 17px;
      margin-bottom: 6px;
      margin-top: 0;
    }

    pre.codeblock {
      background: #f5f5f5;
      border-radius: 4px;
      padding: 18px 19px 16px 19px;
      font-size: 15px;
      color: #444;
      margin: 0 0 23px 0;
      border: 1px solid #ececec;
      font-family: "Fira Mono", "Consolas", "Menlo", "Monaco", "Liberation Mono", "Courier New", monospace;
      overflow-x: auto;
      white-space: pre;
    }

    h2 {
      font-size: 24px;
      font-family: 'Roboto Slab', 'Merriweather', serif;
      font-weight: 700;
      color: #333;
      margin: 31px 0 10px 0;
      line-height: 1.18;
      letter-spacing: 0;
    }

    p {
      margin-top: 0;
      margin-bottom: 16px;
    }

    ul, ol {
      margin: 0 0 16px 32px;
      padding: 0;
    }

    .inline-code {
      background: #f5f5f5;
      border-radius: 3px;
      padding: 0px 4px;
      font-size: 15px;
      font-family: "Fira Mono", "Consolas", "Menlo", "Monaco", "Liberation Mono", "Courier New", monospace;
      color: #444;
    }

    @media (max-width:800px) {
      .container {
        padding-left: 16px;
        padding-right: 16px;
      }
    }
    @media (max-width:520px) {
      h1 {
        font-size: 28px;
      }
      .container {
        padding-left: 5px;
        padding-right: 5px;
      }
      h2 {
        font-size: 19px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="site-title">Polibyte</div>
      <a class="top-link" href="#">About Me</a>
    </header>
    <main>
      <h1>Export news from google sites</h1>
      <div class="meta">
        <span>Apr 27, 2012</span>
        <span>1 minute read</span>
      </div>
      <p class="lead">
        I’ve added a script, <a href="#">export_google_site_news</a>, to my catchall repository on github.
      </p>
      <p class="example-note">
        For example, to download the news stories at<br>
        https://sites.google.com/a/medinacommunityband.org/www/announcements, you<br>
        would run
      </p>
      <pre class="codeblock">export_google_site_news \
 https://sites.google.com/a/medinacommunityband.org/www \
 announcements</pre>

      <h2>The backstory</h2>
      <p>When Free It Athens moved our website from Google Sites to Drupal, we started from scratch rather than importing our old content. I realized on Wednesday that the news posts on the site were interesting historical information, yet I’d never archived them.</p>
      <p>First, I tried a recursive wget.</p>
      <pre class="codeblock">wget -r --no-parent --no-clobber \
""</pre>
      <p>This failed to work because Google pointlessly used javascript rather than anchor tags to link between the news listing pages.</p>
      <p>Next I found and tried to use the google-sites-export tool from Google’s Data Liberation Team, but I was never able to authenticate succesfully from it.</p>
      <p>At this point I was worried I’d need to use a tool like Selenium to run the javascript, but then I realized the news listing pages took a single parameter to determine how far along in the pagination they were. It wouldn’t take more than a C-style for loop to download them all.</p>
      <pre class="codeblock">for i in $(seq 0 10 120); do
  wget "" \
  "-Onews.$i"
done</pre>
      <p>After doing that, I looked at the first one and determined a pattern that would match the relative URLs of individual news stories. I then extracted all the URLs.</p>
      <pre class="codeblock">grep -E -h -o '/a/freeitathens.org/foo/news/[a-z0-9\-_]+' news.* | 
sort -u &gt; news_links</pre>
      <p>Once I had the list of URLs, it was simple to have wget download them all.</p>
      <pre class="codeblock">wget -i news_links -B https://sites.google.com</pre>
      <p>Since I didn’t find any other guides to doing this, I decided to flesh out what I’d done into a simple tool and write about it here.</p>
    </main>
  </div>
</body>
</html>