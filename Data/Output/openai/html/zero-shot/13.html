<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Export news from google sites - Polibyte</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Fonts: Lora, Open Sans -->
  <link href="https://fonts.googleapis.com/css?family=Lora:400,400italic,700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" rel="stylesheet">
  <style>
    html {
      box-sizing: border-box;
      font-size: 18px;
    }
    *, *:before, *:after {
      box-sizing: inherit;
    }

    body {
      margin: 0;
      background: #fcfcfb;
      color: #444;
      font-family: 'Lora', Georgia, serif;
      font-size: 1rem;
      line-height: 1.6;
      letter-spacing: 0;
      min-width: 320px;
    }
    /* Layout containers */
    .container {
      max-width: 700px;
      margin: 0 auto;
      padding: 0 16px 80px 16px;
      background: transparent;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-top: 32px;
      margin-bottom: 40px;
      width: 100%;
    }
    .site-title {
      font-family: 'Lora', Georgia, serif;
      font-size: 1.22rem;
      font-weight: 400;
      color: #2d2d2d;
      margin: 0;
      letter-spacing: 0.01em;
    }
    .about-link {
      font-family: 'Lora', Georgia, serif;
      font-size: 1.06rem;
      color: #847561;
      text-decoration: none;
      margin-top: 5px;
      transition: color 0.2s;
    }
    .about-link:focus,
    .about-link:hover {
      text-decoration: underline;
      color: #59492e;
      outline: 2px dotted #000;
      outline-offset: 2px;
    }

    main {
      width: 100%;
    }

    /* Title */
    .post-title {
      font-family: 'Open Sans', Arial, sans-serif;
      font-weight: 700;
      font-size: 2.6rem;
      line-height: 1.12;
      color: #222;
      margin: 0 0 18px 0;
      letter-spacing: -0.01em;
    }
    /* Post meta */
    .post-meta {
      font-family: 'Lora', Georgia, serif;
      font-style: italic;
      font-size: 1rem;
      line-height: 1.2;
      color: #848585;
      margin-bottom: 2px;
      margin-top: -2px;
      display: flex;
      gap: 0.7em;
      align-items: center;
    }
    .post-date {
      font-size: 1rem;
    }
    .post-readtime {
      font-size: 0.95rem;
    }

    /* Content links */
    .post-content a {
      color: #298fcf;
      text-decoration: underline;
      transition: color 0.18s;
      word-break: break-all;
    }
    .post-content a:focus,
    .post-content a:hover {
      color: #133b56;
      outline: 2px dotted #000;
      outline-offset: 2px;
    }

    /* Post content */
    .post-content {
      margin-top: 0;
      margin-bottom: 0;
      font-size: 1.08rem;
      color: #444;
    }
    .post-content p {
      margin-top: 1.1em;
      margin-bottom: 1.1em;
      font-family: 'Lora', Georgia, serif;
      font-size: 1.08rem;
    }

    /* Inline code */
    .post-content code {
      font-family: 'Menlo', 'Monaco', monospace;
      font-size: 0.98em;
      background: #ececec;
      color: #313131;
      border-radius: 3px;
      padding: 0.08em 0.4em;
      word-break: break-all;
    }

    /* Code blocks */
    .code-block {
      background: #f4f4f4;
      border-radius: 4px;
      box-shadow: none;
      border: 1px solid #e7e5e5;
      font-family: 'Menlo', 'Monaco', monospace;
      font-size: 0.98em;
      color: #222;
      padding: 1em 1.1em;
      margin: 1.1em 0;
      white-space: pre;
      overflow-x: auto;
      word-break: break-all;
    }
    /* Section headings */
    .post-content h2, .post-content h3 {
      font-family: 'Open Sans', Arial, sans-serif;
      font-size: 1.38rem;
      font-weight: 700;
      margin-top: 2.2em;
      margin-bottom: 0.7em;
      color: #24221f;
    }
    .post-content h2 {
      font-size: 1.41rem;
    }
    .post-content h3 {
      font-size: 1.09rem;
    }

    /* Accessibility: Focus-visible outline */
    a:focus-visible, button:focus-visible, input:focus-visible, textarea:focus-visible {
      outline: 2px dotted #191919;
      outline-offset: 2px;
    }

    /* Responsive adjustments */
    @media (max-width: 850px) {
      .container {
        padding-left: 9px;
        padding-right: 9px;
      }
      .post-title {
        font-size: 2rem;
      }
    }
    @media (max-width: 480px) {
      .header {
        flex-direction: column;
        align-items: flex-start;
        row-gap: 6px;
      }
      .post-title {
        font-size: 1.26rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header" role="banner">
      <div class="site-title">Polibyte</div>
      <a class="about-link" href="#" aria-label="About Me">About Me</a>
    </header>
    <main id="main-content" tabindex="-1" aria-labelledby="post-title">
      <h1 id="post-title" class="post-title">Export news from google sites</h1>
      <div class="post-meta">
        <span class="post-date">Apr 27, 2012</span>
        <span aria-hidden="true" style="color:#c1c1c1;">&bull;</span>
        <span class="post-readtime">1 minute read</span>
      </div>
      <section class="post-content">
        <p>
          I’ve added a script, <a href="#">export_google_site_news</a>, to my catchall repository on github.
        </p>
        <p>
          For example, to download the news stories at<br>
          https://sites.google.com/a/medinacommunityband.org/www/announcements, you would run
        </p>
        <div class="code-block" role="region" aria-label="code example">
export_google_site_news \
https://sites.google.com/a/medinacommunityband.org/www \
announcements
        </div>
        <h2>The backstory</h2>
        <p>
          When Free It Athens moved our website from Google Sites to Drupal, we started from scratch rather than importing our old content. I realized on Wednesday that the news posts on the site were interesting historical information, yet I’d never archived them.
        </p>
        <p>
          First, I tried a recursive wget.
        </p>
        <div class="code-block" role="region" aria-label="code example">
wget -r --no-parent --no-clobber \
""
        </div>
        <p>
          This failed to work because Google pointlessly used javascript rather than anchor tags to link between the news listing pages.
        </p>
        <p>
          Next I found and tried to use the google-sites-export tool from Google’s Data Liberation Team, but I was never able to authenticate succesfully from it.
        </p>
        <p>
          At this point I was worried I’d need to use a tool like Selenium to run the javascript, but then I realized the news listing pages took a single parameter to determine how far along in the pagination they were. It wouldn’t take more than a C-style for loop to download them all.
        </p>
        <div class="code-block" role="region" aria-label="code example">
for i in $(seq 0 10 120); do
  wget "" \
  "-Onews.$i"
done
        </div>
        <p>
          After doing that, I looked at the first one and determined a pattern that would match the relative URLs of individual news stories. I then extracted all the URLs.
        </p>
        <div class="code-block" role="region" aria-label="code example">
grep -E -h -o '/a/fre​eithatens.org/foo/news/[a-z0-9\-_]+' news.* | 
sort -u &gt; news_links
        </div>
        <p>
          Once I had the list of URLs, it was simple to have wget download them all.
        </p>
        <div class="code-block" role="region" aria-label="code example">
wget -i news_links -B https://sites.google.com
        </div>
        <p>
          Since I didn’t find any other guides to doing this, I decided to flesh out what I’d done into a simple tool and write about it here.
        </p>
      </section>
    </main>
  </div>
</body>
</html>